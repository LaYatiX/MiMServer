<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="utf-8">
    <title>Analyser</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <script src="jquery-3.2.1.min.js"></script>
</head>

<body onload="init();">

    <div class="grid">

        <div class ="container" id="v1-box">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class ="rounded-bar" id="v1">
                <circle class="backdrop" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <circle class="progress" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <g transform="rotate(90, 50, 50)" class="bar-text">
                <text x="50" y="50" class="bar-number">
                </text>
                <text x="50" y="50" class="bar-label">
                Volts
                </text>
                </g>
        </svg>
        </div>

        <div class ="container" id="v2-box">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class ="rounded-bar" id="v2">
                <circle class="backdrop" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <circle class="progress" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <g transform="rotate(90, 50, 50)" class="bar-text">
                <text x="50" y="50" class="bar-number">
                </text>
                <text x="50" y="50" class="bar-label">
                    Volts
                </text>
                </g>
            </svg>
        </div>

        <div class ="container" id="v3-box">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class ="rounded-bar" id="v3">
                <circle class="backdrop" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <circle class="progress" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <g transform="rotate(90, 50, 50)" class="bar-text">
                <text x="50" y="50" class="bar-number">
                </text>
                <text x="50" y="50" class="bar-label">
                    Volts
                </text>
                </g>
            </svg>
        </div>

        <div class ="container" id="c1-box">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class ="rounded-bar" id="c1">
                <circle class="backdrop" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <circle class="progress" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <g transform="rotate(90, 50, 50)" class="bar-text">
                <text x="50" y="50" class="bar-number">
                </text>
                <text x="50" y="50" class="bar-label">
                    Amperes
                </text>
                </g>
            </svg>
        </div>
    
        <div class ="container" id="c2-box">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class ="rounded-bar" id="c2">
                <circle class="backdrop" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <circle class="progress" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <g transform="rotate(90, 50, 50)" class="bar-text">
                <text x="50" y="50" class="bar-number">
                </text>
                <text x="50" y="50" class="bar-label">
                    Amperes
                </text>
                </g>
            </svg>
        </div>
    
        <div class ="container" id="c3-box">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" class ="rounded-bar" id="c3">
                <circle class="backdrop" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <circle class="progress" r="39.7887357725" cy="50" cx="50" fill="none"/>
                <g transform="rotate(90, 50, 50)" class="bar-text">
                <text x="50" y="50" class="bar-number">
                </text>
                <text x="50" y="50" class="bar-label">
                    Amperes
                </text>
                </g>
            </svg>
        </div>
  
    </div>

    <script>

    function init() {
        getData();
    }

    function getData() {
        window.WebSocket = window.WebSocket || window.MozWebSocket;
        var connection = new WebSocket("ws://pkprojectserver.hopto.org:1337");

        connection.onopen = function () {
            console.log('WebSocket Status: OPEN');
        }

        connection.onmessage = function(message) {
            var outputArray = message.data.split(";");

            updateContent(outputArray);
        }

        setInterval(function() {
            var outputArray = Array.from({length: 6}, () => Math.floor(Math.random() * 130 + 30));

            updateContent(outputArray);
        }, 600);
    }

    function updateContent(outputArray) {
        for (let sentinel = 0; sentinel < outputArray.length; ++sentinel) {
            var value = +outputArray[sentinel];
            var $circle = $('.progress');
            
            if (isNaN(value)) {
                value = 250;
            }
            else {
                var radius = $circle.eq(sentinel).attr('r');
                var circumference = Math.PI * (radius * 2);
            
                if (value < -250) {
                    value = 0;
                }

                if (value > 250) {
                    value = 250;
                }
                
                var fillingValue = ((250 - value) / 250) * circumference;
                
                $circle.eq(sentinel).css({
                    strokeDashoffset: fillingValue
                });
                $('.bar-number').eq(sentinel).html(parseInt(value));
            }
        }
    }

    </script>

</body>

</html>